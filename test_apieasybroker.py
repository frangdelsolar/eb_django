import unittest
from unittest.mock import Mock, patch
from apieasybroker import APIEasyBroker


class TestAPIEasyBroker(unittest.TestCase):

    def test_init(self):
        """
        Tests APIEasyBroker initialization, with correct class variables.
        """
        api = APIEasyBroker()
        self.assertEqual(
            api.api_url, "https://api.stagingeb.com/v1/properties")
        self.assertIsNotNone(api.token)

    def test_get_headers(self):
        """
        Tests APIEasyBroker headers generation.
        """
        api = APIEasyBroker()
        headers = api.get_headers()
        self.assertEqual(headers['accept'], 'application/json')
        self.assertIsNotNone(headers['X-Authorization'])

    def test_fetch_data(self):
        """
        Tests APIEasyBroker data call from api url.
        """
        api = APIEasyBroker()
        url = "https://api.stagingeb.com/v1/properties?page=1&limit=20"

        with patch("requests.get") as mock_get:
            mock_get.return_value.status_code = 200
            mock_get.return_value.json.return_value = {"content": [{'public_id': 'EB-C0156', 'title': 'Casa con uso de suelo prueba', 'title_image_full': 'https://assets.stagingeb.com/property_images/30156/116630/EB-C0156.png?version=1598540675', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/30156/116630/EB-C0156_thumb.png?version=1598540675', 'location': 'La Punta, Cosío, Aguascalientes', 'operations': [{'type': 'sale', 'amount': 12312312.0, 'currency': 'MXN', 'formatted_amount': '$12,312,312', 'commission': {'type': 'percentage', 'value': '5.0'}, 'unit': 'total'}], 'bedrooms': 1, 'bathrooms': 2, 'parking_spaces': None, 'property_type': 'Casa con uso de suelo', 'lot_size': 0.0, 'construction_size': 0.0, 'updated_at': '2020-12-10T11:47:38-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': True}, {'public_id': 'EB-C0313', 'title': 'afsdf', 'title_image_full': None, 'title_image_thumb': None, 'location': 'Ciudad Insurgentes, Comondú, Baja California Sur', 'operations': [{'type': 'sale', 'amount': 234223.0, 'currency': 'MXN', 'formatted_amount': '$234,223', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Bodega industrial', 'lot_size': 342.0, 'construction_size': 432.0, 'updated_at': '2020-12-10T11:47:38-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': True}, {'public_id': 'EB-B5338', 'title': 'Locales en Venta Edificio Roble en San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25338/49435/EB-B5338.jpg?version=1555543329', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25338/49435/EB-B5338_thumb.jpg?version=1555543329', 'location': 'Valle Del Campestre, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'sale', 'amount': 5506200.0, 'currency': 'MXN', 'formatted_amount': '$5,506,200', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Local comercial', 'lot_size': 0.0, 'construction_size': 61.0, 'updated_at': '2020-12-14T17:07:37-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5339', 'title': 'Locales en Venta Amadeus Calzada del Valle', 'title_image_full': 'https://assets.stagingeb.com/property_images/25339/49442/EB-B5339.jpg?version=1555543334', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25339/49442/EB-B5339_thumb.jpg?version=1555543334', 'location': 'Del Valle, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'sale', 'amount': 5954400.0, 'currency': 'MXN', 'formatted_amount': '$5,954,400', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': 114, 'property_type': 'Local en centro comercial', 'lot_size': 0.0, 'construction_size': 49.0, 'updated_at': '2020-12-14T17:07:37-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5357', 'title': 'Locales Comerciales en Venta Vasconcelos San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25357/49606/EB-B5357.jpg?version=1601049752', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25357/49606/EB-B5357_thumb.jpg?version=1601049752', 'location': 'Valle de Vasconcelos, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'sale', 'amount': 2945600.0, 'currency': 'MXN', 'formatted_amount': '$2,945,600', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': 154, 'property_type': 'Local en centro comercial', 'lot_size': 0.0, 'construction_size': 36.0, 'updated_at': '2020-12-14T17:07:37-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5372', 'title': 'Local en Renta Plaza Villas Valle San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25372/49729/EB-B5372.jpg?version=1555543525', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25372/49729/EB-B5372_thumb.jpg?version=1555543525', 'location': 'Del Valle, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 400.0, 'currency': 'MXN', 'formatted_amount': '$400', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Local comercial', 'lot_size': 0.0, 'construction_size': 1.0, 'updated_at': '2020-12-14T17:07:38-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5378', 'title': 'Departamento en Renta Torre Arcangeles en San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25378/49796/EB-B5378.jpg?version=1555543572', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25378/49796/EB-B5378_thumb.jpg?version=1555543572', 'location': 'Los Arcángeles, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 38000.0, 'currency': 'MXN', 'formatted_amount': '$38,000', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': 2, 'bathrooms': 3, 'parking_spaces': None, 'property_type': 'Departamento', 'lot_size': 0.0, 'construction_size': 0.0, 'updated_at': '2020-12-14T17:07:38-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5387', 'title': 'Oficinas en Venta en Valle Oriente', 'title_image_full': 'https://assets.stagingeb.com/property_images/25387/49925/EB-B5387.jpg?version=1555543660', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25387/49925/EB-B5387_thumb.jpg?version=1555543660', 'location': 'Hacienda de La Sierra, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'sale', 'amount': 67000.0, 'currency': 'MXN', 'formatted_amount': '$67,000', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Oficina', 'lot_size': 0.0, 'construction_size': 0.0, 'updated_at': '2020-12-14T17:07:38-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5396', 'title': 'Casa en Renta en Lomas del Valle en San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25396/50038/EB-B5396.jpg?version=1555543740', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25396/50038/EB-B5396_thumb.jpg?version=1555543740', 'location': 'Lomas Del Valle, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 90000.0, 'currency': 'MXN', 'formatted_amount': '$90,000', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': 4, 'bathrooms': 4, 'parking_spaces': 2, 'property_type': 'Casa', 'lot_size': 1.0, 'construction_size': 1.0, 'updated_at': '2020-12-14T17:07:38-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5398', 'title': 'Departamentos Amueblados en Renta Valle Oriente', 'title_image_full': 'https://assets.stagingeb.com/property_images/25398/50065/EB-B5398.jpg?version=1555543756', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25398/50065/EB-B5398_thumb.jpg?version=1555543756', 'location': 'Zona Valle Oriente Norte, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 19000.0, 'currency': 'MXN', 'formatted_amount': '$19,000', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': 2, 'bathrooms': 2, 'parking_spaces': 2, 'property_type': 'Departamento', 'lot_size': 0.0, 'construction_size': 140.0, 'updated_at': '2020-12-14T17:07:38-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5359', 'title': 'Oficinas en Renta en Torre Altha San Pedro Garza Garcia',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       'title_image_full': 'https://assets.stagingeb.com/property_images/25359/49622/EB-B5359.jpg?version=1555543455', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25359/49622/EB-B5359_thumb.jpg?version=1555543455', 'location': 'Valle Del Campestre, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 290.0, 'currency': 'MXN', 'formatted_amount': '$290', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Oficina', 'lot_size': 0.0, 'construction_size': 500.0, 'updated_at': '2020-12-14T17:07:39-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5361', 'title': 'Oficina en Venta Centrito 360 San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25361/49640/EB-B5361.jpg?version=1555543467', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25361/49640/EB-B5361_thumb.jpg?version=1555543467', 'location': 'Del Valle, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'sale', 'amount': 13378350.0, 'currency': 'MXN', 'formatted_amount': '$13,378,350', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Oficina', 'lot_size': 0.0, 'construction_size': 248.0, 'updated_at': '2020-12-14T17:07:39-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5365', 'title': 'Oficinas en Renta en Colonia del Valle San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25365/49677/EB-B5365.jpg?version=1555543490', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25365/49677/EB-B5365_thumb.jpg?version=1555543490', 'location': 'Del Valle, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 75000.0, 'currency': 'MXN', 'formatted_amount': '$75,000', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': 6, 'property_type': 'Oficina', 'lot_size': 0.0, 'construction_size': 350.0, 'updated_at': '2020-12-14T17:07:39-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5424', 'title': 'Local en Venta Centrito 360 San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25424/50368/EB-B5424.jpg?version=1555543947', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25424/50368/EB-B5424_thumb.jpg?version=1555543947', 'location': 'Del Valle, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'sale', 'amount': 3928965.0, 'currency': 'MXN', 'formatted_amount': '$3,928,965', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Local en centro comercial', 'lot_size': 0.0, 'construction_size': 55.0, 'updated_at': '2020-12-14T17:07:39-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5433', 'title': 'Departamento Amueblado en Renta Valle San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25433/50438/EB-B5433.jpg?version=1555543993', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25433/50438/EB-B5433_thumb.jpg?version=1555543993', 'location': 'Fuentes del Valle, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 16000.0, 'currency': 'MXN', 'formatted_amount': '$16,000', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': 0, 'bathrooms': 1, 'parking_spaces': 1, 'property_type': 'Departamento', 'lot_size': 0.0, 'construction_size': 33.0, 'updated_at': '2020-12-14T17:07:39-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5403', 'title': 'Casa en Renta en Privanzas San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25403/50114/EB-B5403.jpg?version=1555543787', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25403/50114/EB-B5403_thumb.jpg?version=1555543787', 'location': 'Privanzas Alejandría, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 32500.0, 'currency': 'MXN', 'formatted_amount': '$32,500', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': 3, 'bathrooms': 3, 'parking_spaces': 2, 'property_type': 'Casa', 'lot_size': 410.0, 'construction_size': 420.0, 'updated_at': '2020-12-14T17:07:40-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5409', 'title': 'Local Comercial en Renta en Plaza Cen 333 San Pedro', 'title_image_full': 'https://assets.stagingeb.com/property_images/25409/50220/EB-B5409.jpg?version=1555543854', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25409/50220/EB-B5409_thumb.jpg?version=1555543854', 'location': 'Condominio, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 29858.0, 'currency': 'MXN', 'formatted_amount': '$29,858', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Local en centro comercial', 'lot_size': 0.0, 'construction_size': 90.0, 'updated_at': '2020-12-14T17:07:40-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5415', 'title': 'Departamento Amueblado en Renta Torre Koi Valle Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25415/50270/EB-B5415.jpg?version=1555543886', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25415/50270/EB-B5415_thumb.jpg?version=1555543886', 'location': 'Colonia Valle Oriente Sur, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 49000.0, 'currency': 'MXN', 'formatted_amount': '$49,000', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': 2, 'bathrooms': 2, 'parking_spaces': 2, 'property_type': 'Departamento', 'lot_size': 0.0, 'construction_size': 160.0, 'updated_at': '2020-12-14T17:07:40-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5418', 'title': 'Local en Renta Plaza Maranta San Pedro Garza Garcia', 'title_image_full': 'https://assets.stagingeb.com/property_images/25418/50318/EB-B5418.jpg?version=1555543914', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25418/50318/EB-B5418_thumb.jpg?version=1555543914', 'location': 'Del Valle, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 22000.0, 'currency': 'MXN', 'formatted_amount': '$22,000', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Local comercial', 'lot_size': 0.0, 'construction_size': 40.0, 'updated_at': '2020-12-14T17:07:40-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}, {'public_id': 'EB-B5422', 'title': 'Local Renta Valle', 'title_image_full': 'https://assets.stagingeb.com/property_images/25422/50363/EB-B5422.jpg?version=1555543943', 'title_image_thumb': 'https://assets.stagingeb.com/property_images/25422/50363/EB-B5422_thumb.jpg?version=1555543943', 'location': 'Del Valle, San Pedro Garza García, Nuevo León', 'operations': [{'type': 'rental', 'amount': 22000.0, 'currency': 'MXN', 'formatted_amount': '$22,000', 'commission': {'type': 'percentage'}, 'unit': 'total'}], 'bedrooms': None, 'bathrooms': None, 'parking_spaces': None, 'property_type': 'Local en centro comercial', 'lot_size': 0.0, 'construction_size': 40.0, 'updated_at': '2020-12-14T17:07:40-06:00', 'agent': 'Alejandro Blanco Zivec', 'show_prices': True, 'share_commission': False}]}
            response = api.fetch_data(url)

            self.assertEqual(200, response.status_code)
            self.assertEqual(20, len(response.json()['content']))


if __name__ == '__main__':
    unittest.main()
